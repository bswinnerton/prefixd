# Dual Router FlowSpec Lab
# 
# Tests FlowSpec propagation to BOTH vJunos-router and cJunosEvolved simultaneously
# Useful for comparing behavior between classic Junos (MX) and Junos Evolved (PTX)
#
# Prerequisites:
#   1. Download both images from Juniper
#   2. Import both:
#      containerlab tools vrnetlab import vjunos-router-23.2R1.15.qcow2
#      containerlab tools vrnetlab import cjunosevolved-24.2R1.17.qcow2
#
# Usage:
#   sudo containerlab deploy -t dual-flowspec.clab.yml
#   sudo containerlab destroy -t dual-flowspec.clab.yml
#
# Resource requirements: ~13GB RAM, 8 CPU cores

name: dual-flowspec

mgmt:
  network: clab-mgmt-dual
  ipv4-subnet: 172.20.30.0/24

topology:
  nodes:
    # GoBGP - FlowSpec announcer (connected to prefixd)
    # Announces to both routers simultaneously
    gobgp:
      kind: linux
      image: jauderho/gobgp:latest
      binds:
        - gobgp-dual.conf:/etc/gobgp/gobgp.conf:ro
      exec:
        - gobgpd -f /etc/gobgp/gobgp.conf -p --api-hosts=0.0.0.0:50051
      mgmt-ipv4: 172.20.30.2
      ports:
        - 50053:50051  # gRPC API for prefixd

    # vJunos-router - MX-based classic Junos
    vjunos:
      kind: juniper_vjunosrouter
      image: vrnetlab/juniper_vjunosrouter:23.2R1
      mgmt-ipv4: 172.20.30.3
      startup-config: vjunos-dual-config.txt

    # cJunosEvolved - PTX-based Junos Evolved
    cjunos:
      kind: juniper_vjunosevolved
      image: vrnetlab/juniper_vjunosevolved:24.2R1
      mgmt-ipv4: 172.20.30.4
      startup-config: cjunos-dual-config.txt

  links:
    # GoBGP to vJunos
    - endpoints: ["gobgp:eth1", "vjunos:eth1"]
    # GoBGP to cJunos
    - endpoints: ["gobgp:eth2", "cjunos:eth1"]
