## cJunosEvolved FlowSpec configuration
## AS 65003 - receives FlowSpec from GoBGP (AS 65001)
##
## Note: Junos Evolved syntax differs slightly from classic Junos

system {
    host-name cjunos-flowspec;
    root-authentication {
        encrypted-password "$6$rounds=5000$abc123$xyz"; /* admin@123 */
    }
    login {
        user admin {
            class super-user;
            authentication {
                encrypted-password "$6$rounds=5000$abc123$xyz"; /* admin@123 */
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
}

interfaces {
    et-0/0/0 {
        description "Link to GoBGP";
        unit 0 {
            family inet {
                address 10.0.1.2/30;
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 192.0.2.2/32;
            }
        }
    }
}

routing-options {
    router-id 192.0.2.2;
    autonomous-system 65003;
    flow {
        /* Enable FlowSpec route installation */
        validation;
        /* Install FlowSpec as firewall filters */
        term-order standard;
    }
}

policy-options {
    policy-statement FLOWSPEC-IMPORT {
        term accept-all {
            then accept;
        }
    }
}

protocols {
    bgp {
        group GOBGP {
            type external;
            description "FlowSpec from prefixd via GoBGP";
            import FLOWSPEC-IMPORT;
            peer-as 65001;
            neighbor 10.0.1.1 {
                family inet {
                    flow {
                        /* Receive IPv4 FlowSpec */
                        no-validate FLOWSPEC-IMPORT;
                    }
                }
            }
        }
    }
}
