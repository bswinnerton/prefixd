# cJunosEvolved FlowSpec Lab
#
# Tests FlowSpec propagation: prefixd -> prefixd-gobgp -> cJunosEvolved
# cJunos peers with the prefixd docker-compose GoBGP over shared network.
#
# Prerequisites:
#   1. KVM support: ls /dev/kvm
#   2. Download cJunosEvolved from Juniper (free, no account needed)
#   3. Load image: docker load -i cJunosEvolved-25.4R1.13-EVO.tar.gz
#   4. prefixd stack running: docker compose up -d
#
# Usage:
#   sudo containerlab deploy -t cjunos-flowspec.clab.yml
#   # Wait ~3-5 min for router to boot
#   # Connect prefixd-gobgp to clab network:
#   docker network connect clab-mgmt-evo prefixd-gobgp --ip 172.30.31.10
#   # Restart GoBGP to pick up cJunos neighbor from configs/gobgp.conf:
#   docker restart prefixd-gobgp
#   # Verify BGP session:
#   docker exec prefixd-gobgp gobgp neighbor
#   # Cleanup:
#   docker network disconnect clab-mgmt-evo prefixd-gobgp
#   sudo containerlab destroy -t cjunos-flowspec.clab.yml --cleanup

name: cjunos-flowspec

mgmt:
  network: clab-mgmt-evo
  ipv4-subnet: 172.30.31.0/24

topology:
  nodes:
    router:
      kind: juniper_cjunosevolved
      image: cjunosevolved:25.4R1.13-EVO
      mgmt-ipv4: 172.30.31.3
      startup-config: cjunos-config.txt
      env:
        CPTX_COSIM: "BX"
