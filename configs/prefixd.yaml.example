# prefixd configuration example
# Copy to prefixd.yaml and customize for your deployment

# POP identifier (for multi-POP deployments)
pop: iad1

# Operation mode: dry-run (log only) or enforced (announce FlowSpec)
mode: dry-run

http:
  listen: "0.0.0.0:8080"
  auth:
    # Auth modes: none, bearer, mtls, credentials
    mode: credentials
    # For bearer mode, set env var name containing the token
    # bearer_token_env: "PREFIXD_API_TOKEN"
  rate_limit:
    events_per_second: 100
    burst: 500
  # TLS configuration (optional)
  # tls:
  #   cert_path: "/etc/prefixd/server.crt"
  #   key_path: "/etc/prefixd/server.key"
  #   ca_path: "/etc/prefixd/ca.crt"  # For mTLS

bgp:
  # BGP modes: sidecar (real GoBGP) or mock (testing)
  mode: sidecar
  gobgp_grpc: "gobgp:50051"
  local_asn: 65010
  router_id: "10.10.0.10"
  neighbors: []

guardrails:
  require_ttl: true
  dst_prefix_minlen: 32
  dst_prefix_maxlen: 32
  # IPv6 prefix length limits
  # dst_prefix_minlen_v6: 128
  # dst_prefix_maxlen_v6: 128
  max_ports: 8
  allow_src_prefix_match: false

quotas:
  max_active_per_customer: 5
  max_active_per_pop: 200
  max_active_global: 500
  max_new_per_minute: 30

timers:
  default_ttl_seconds: 120
  min_ttl_seconds: 30
  max_ttl_seconds: 1800
  correlation_window_seconds: 300
  reconciliation_interval_seconds: 30

escalation:
  enabled: true
  min_persistence_seconds: 120
  min_confidence: 0.7

storage:
  # DATABASE_URL env var takes precedence over this value
  connection_string: "postgres://prefixd:changeme@localhost:5432/prefixd"

observability:
  log_format: json
  log_level: info
  audit_log_path: "/var/log/prefixd/audit.jsonl"
  metrics_listen: "0.0.0.0:9090"

safelist:
  # Prefixes that should never be mitigated
  prefixes:
    - "10.0.0.0/8"       # Internal
    - "192.168.0.0/16"   # Internal

shutdown:
  drain_timeout_seconds: 30
  preserve_announcements: true
